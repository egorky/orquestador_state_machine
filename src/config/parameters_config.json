{
    "id_number": {
        "question": "Por favor, deme su número de identificación.",
        "post_ask_steps": [
            {
                "tool": "ai",
                "prompt": "Extrae el número de identificación del texto del usuario. Responde en un JSON con la clave 'id_number'."
            },
            {
                "tool": "validate",
                "parameter": "id_number"
            }
        ]
    },
    "city": {
        "question": "¿En qué ciudad desea agendar su cita? Tenemos disponibles en: {cities_list}",
        "pre_ask_steps": [
            {
                "tool": "api",
                "name": "fetch_cities_api",
                "output_key": "cities_data"
            },
            {
                "tool": "script",
                "name": "format_cities_list",
                "input_key": "cities_data",
                "output_key": "cities_list"
            }
        ],
        "post_ask_steps": [
            {
                "tool": "ai",
                "prompt": "De la respuesta del usuario, y de la lista de ciudades en el contexto, extrae el ID de la ciudad. Responde en un JSON con la clave 'city_id'."
            },
            {
                "tool": "validate",
                "parameter": "city"
            }
        ]
    },
    "branch": {
        "question": "Perfecto. ¿En cuál de nuestras sucursales en {city_name} desea su cita? Puede escoger entre: {branches_list}",
        "pre_ask_steps": [
            {
                "tool": "api",
                "name": "fetch_branches_api",
                "input_keys": { "city_id": "context.city_id" },
                "output_key": "branches_data"
            },
            {
                "tool": "script",
                "name": "format_branches_list",
                "input_key": "branches_data",
                "output_key": "branches_list"
            }
        ],
        "post_ask_steps": [
            {
                "tool": "ai",
                "prompt": "De la respuesta del usuario, y de la lista de sucursales en el contexto, extrae el ID de la sucursal. Responde en un JSON con la clave 'branch_id'."
            },
            {
                "tool": "validate",
                "parameter": "branch"
            }
        ]
    },
    "speciality": {
        "question": "Excelente. ¿Para qué especialidad necesita la cita? En esta sucursal tenemos: {specialities_list}",
        "pre_ask_steps": [
            {
                "tool": "api",
                "name": "fetch_specialities_api",
                "input_keys": { "branch_id": "context.branch_id" },
                "output_key": "specialities_data"
            },
            {
                "tool": "script",
                "name": "format_specialities_list",
                "input_key": "specialities_data",
                "output_key": "specialities_list"
            }
        ],
        "post_ask_steps": [
            {
                "tool": "ai",
                "prompt": "De la respuesta del usuario, y de la lista de especialidades en el contexto, extrae el ID de la especialidad. Responde en un JSON con la clave 'speciality_id'."
            },
            {
                "tool": "validate",
                "parameter": "speciality"
            }
        ]
    },
    "date_time": {
        "question": "Entendido. ¿En qué fecha y hora desea la cita? Tenemos los siguientes turnos disponibles: {available_times_list}",
        "pre_ask_steps": [
            {
                "tool": "api",
                "name": "fetch_available_times_api",
                "input_keys": { "speciality_id": "context.speciality_id" },
                "output_key": "available_times_data"
            },
            {
                "tool": "script",
                "name": "format_available_times_list",
                "input_key": "available_times_data",
                "output_key": "available_times_list"
            }
        ],
        "post_ask_steps": [
            {
                "tool": "ai",
                "prompt": "De la respuesta del usuario, y de la lista de horarios en el contexto, extrae la fecha y hora seleccionada. Responde en un JSON con la clave 'date_time'."
            },
            {
                "tool": "validate",
                "parameter": "date_time"
            }
        ]
    }
}